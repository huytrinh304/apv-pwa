<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>eParking</title>

  <link rel="manifest" href="/manifest.json">
  <!-- plugins:css -->
  <link rel="stylesheet" href="vendors/feather/feather.css">
  <link rel="stylesheet" href="vendors/ti-icons/css/themify-icons.css">
  <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <link rel="stylesheet" href="vendors/ti-icons/css/themify-icons.css">
  <link rel="stylesheet" type="text/css" href="js/select.dataTables.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="css/vertical-layout-light/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="images/favicon.pngg" />



</head>

<body>
  <div class="container-scroller"> 
      <!-- partial -->  
      <div class="main-panel">
        <div class="content-wrapper"> 
          <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title">Thêm tác vụ</p> 
                  <div class="row">
                    <div class="col-12">
                      <div class="row">
                        <button  type="button" class="btn btn-primary btn-md btn-block" data-toggle="modal" data-target=".bd-example-modal-lg">Thêm mới</button> 
                        <div  class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
                          aria-labelledby="myLargeModalLabel" aria-hidden="true">
                          <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h4 class="modal-title" id="myLargeModalLabel">Thêm mới</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">×</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <div class="row">
                                  <div class="col-12 grid-margin">
                                    <div class="card">
                                      <div class="card-body">
                                        <h4 class="card-title">Thêm tác vụ</h4>
                                        <form class="form-sample"> 
                                          <div class="row">
                                            <div class="col-md-6">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Tên khách hàng</label>
                                                <div class="col-sm-9">
                                                  <input id="name" type="text" class="form-control" />
                                                </div>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Số điện thoại</label>
                                                <div class="col-sm-9">
                                                  <input id="phone" type="text" class="form-control" />
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="row">
                                            <div class="col-md-6">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Điểm xuất phát</label>
                                                <div class="col-sm-9">
                                                  <input id="fromAddress" list="FromList" type="text" class="form-control"
                                                    placeholder="30 Trịnh Đình Thảo">
                                                </div>
                                                <datalist id="FromList">
                                                  <option value="30 Trịnh Đình Thảo">
                                                  <option value="86 Trịnh Đình Trọng">
                                                </datalist>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Điểm đến</label>
                                                <div class="col-sm-9">
                                                  <input id="toAddress" list="toList" type="text" class="form-control"
                                                    placeholder="Bệnh viện Đa khoa Tâm Anh">
                                                </div>
                                                <datalist id="toList">
                                                  <option value="Bệnh viện Đa khoa Tâm Anh">
                                                  <option value="Bệnh viện Nhân dân 115">
                                                </datalist>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="row">
                                            <div class="col-md-6">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Tài xế</label>
                                                <div class="col-sm-9">
                                                  <input id="driver" list="driverList" type="text" class="form-control"
                                                    placeholder="Minh | 51B-507.85">
                                                </div>
                                                <datalist id="driverList">
                                                  <option value="Minh | 51B-507.85">
                                                  <option value="Tuan | 51B-511.22">
                                                </datalist>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Tùy chọn</label>
                                                <div class="col-sm-4">
                                                  <div class="form-check">
                                                    <label class="form-check-label">
                                                      <input id="dieuduong" type="checkbox" class="form-check-input"> Điều dưỡng
                                                      <i class="input-helper"></i></label>
                                                  </div>
                                                </div>
                                                <div class="col-sm-5">
                                                  <div class="form-check">
                                                    <label class="form-check-label">
                                                      <input id="maytho" type="checkbox" class="form-check-input"> Máy thở
                                                      <i class="input-helper"></i></label>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="row">
                                            <div class="col-md-12">
                                              <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Số tiền ước tính</label>
                                                <div class="col-sm-9">
                                                  <input id="total" type="text" class="form-control" />
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </form>
                                      </div>
                                      <button type="button" class="btn btn-primary btn-md btn-block" onclick="submit()">
                                        <i class="ti-user"></i>
                                        Lưu tác vụ
                                      </button>
                                    </div> 
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title">Danh sách tác vụ</p> 
                  <div class="row">
                    <div class="col-12">
                      <div class="table-responsive">
                        <table id="myTable" class="display expandable-table" style="width:100%">
                          <thead>
                            <tr>
                              <th>STT</th>
                              <th>Tên khách hàng</th>
                              <th>Số điện thoại</th>
                              <th>Điểm xuất phát</th>
                              <th>Điểm đến</th>
                              <th>Tài xế</th>
                              <th>Điều dưỡng</th>
                              <th>Máy thở</th>
                              <th>Số tiền ước tính</th>
                            </tr>
                          </thead>
                          <tbody id="view"></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- content-wrapper ends -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->

  <!-- End custom js for this page-->
  <script>
const publicVapidKey =
  "BJthRQ5myDgc7OSXzPCMftGw-n16F7zQBEN7EUD6XxcfTTvrLGWSIG7y_JxiWtVlCFua0S8MTB5rPziBqNx1qIo";

if ("serviceWorker" in navigator) {
  send().catch(err => console.error(err));
}

async function send() {
  // Register Service Worker
  const register = await navigator.serviceWorker.register("/sw.js", {
    scope: "/"
  });
  await navigator.serviceWorker.ready; 

  let person = prompt("Please enter your name", "");

    if (person == null || person == "") {
      //text = "User cancelled the prompt.";
    } else {
      // Register Push
      const subscription = await register.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
      });

  // Send Push Notification
  await fetch(`/subscribe?name=${person}`, {
    method: "POST",
    body: JSON.stringify(subscription),
    headers: {
      "content-type": "application/json"
    }
  });
}

}

function urlBase64ToUint8Array(base64String) {
  const padding = "=".repeat((4 - base64String.length % 4) % 4);
  const base64 = (base64String + padding)
    .replace(/\-/g, "+")
    .replace(/_/g, "/");

  const rawData = window.atob(base64);
  const outputArray = new Uint8Array(rawData.length);

  for (let i = 0; i < rawData.length; ++i) {
    outputArray[i] = rawData.charCodeAt(i);
  }
  return outputArray;
}

    function createGuid() {
      function _p8(s) {
        var p = (Math.random().toString(16) + "000000000").substr(2, 8);
        return s ? "-" + p.substr(0, 4) + "-" + p.substr(4, 4) : p;
      }
      return _p8() + _p8(true) + _p8(true) + _p8();
    }
    function submit() {

      const guid = createGuid();
      var name = document.getElementById("name").value;
      var phone = document.getElementById("phone").value;
      var fromAddress = document.getElementById("fromAddress").value;
      var toAddress = document.getElementById("toAddress").value;
      var driver = document.getElementById("driver").value;
      var dieuduong = document.getElementById("dieuduong").checked;
      var maytho = document.getElementById("maytho").checked;
      var total = document.getElementById("total").value;


      const obj = [name, phone, fromAddress, toAddress, driver, dieuduong, maytho, total];
      localStorage.setItem(guid, obj); // create 
      alert("Thêm tác vụ thành công!");
      location.reload();
    }

    var row = '';
    var stt = 0;

    for (var a in localStorage) {
      if (stt < localStorage.length) {
        var obj = localStorage[a];
        var objSplit = obj.toString().split(",");
        row += '<tr>';
        row += '<td>' + stt++ + '</td>';
        row += '<td>' + objSplit[0] + '</td>';
        row += '<td>' + objSplit[1] + '</td>';
        row += '<td>' + objSplit[2] + '</td>';
        row += '<td>' + objSplit[3] + '</td>';
        row += '<td>' + objSplit[4] + '</td>';
        row += '<td>' + objSplit[5] + '</td>';
        row += '<td>' + objSplit[6] + '</td>';
        row += '<td>' + objSplit[7] + '</td>';
        row += '</tr>';
        $('#view').html('');
        $('#view').append(row);
      }
    }
  </script>
</body>

</html>